---
layout: post
title:  "Rich Text Editor"
date:   2018-04-01 23:00:00
categories: JavaScript
tags:  word
comments: false
---

* content
{:toc}

在线富文本编辑器是本平台最重要的组件之一。在整个平台的构建过程中，由于直接和用户的交互相关，因此编辑器的特性起着几乎是决定性的作用。
 <!--more-->

 在一个内容创作型的平台上，尤其是在线服务为主的平台上，富文本编辑器以及相关功能如何构建是相当重要的一部分。在项目一开始的过程中，本人对几个常用的富文本编辑器的生态进行的调研。考虑到二次开发和与内部相关服务的整合，最终决定以百度的ueditor为基础，进行二次开发。

## 整体架构
富文本编辑器在当前项目中，有着较为重要的作用。在刚接手项目之初，项目本身完全以所谓协同创新平台产品为蓝本，复制了一遍。在该项目中涉及到的富文本编辑模块各自分离，不相互关联。CKEditor,ueditor等比较常见的几种编辑器都有用到，但是都在各自模块中满足一定的业务需求。在查找相关资料之后，考虑以下几个因素，决定采用以UEditor为骨架，二次开发的方式进行：


* 较为清晰的核心和二次开发的便捷性
* 较为成熟的复杂数理化公式的插件
* 相对较完整的开发文档和用户群体

在项目正式开始之后，也踩了一些坑，但是总体上来说该方式基本满足了用户要求较高的在线编辑富文本内容的需求。不过，在整个项目的研发过程中，发现同类项目中以微软的office365和谷歌的google docs为首的在线office办公套件当之无愧是大佬。确实厉害，没话说。

当然为了速度，我也将项目中整个完整的系统做了拆解，以便充分利用不同的免费技术完成整个项目的实际需求。

>**文本和段落**：这部分完整的基于ueditor的核心代码，完成文本内容的编辑修改以及相关的段落和样式排版等功能。基本原则是基于段落标签动态更新为行内样式。当然这里还有一些遗留问题并没有完全解决完。

>**公式和图片**：这里主要包含上传的图片，插入的公式图片，复制粘贴过来的图片流。这里的所有底层接口全部拆解，后台重写。这里最重要的工作涉及到两个方面，一个是高清图片的存储问题，一个是图片在编辑器中的排版问题。项目中存储整合了自己的云平台，排版重写了事件监听，以完成等比例缩放，右键删除等功能。

>**视频和文件**：这里涉及到的大文件存储问题和图片是一样的。但是这里还有另一个更为复杂的问题--用户需求要在线预览文件。这里衍生除了另一个文件的预览项目，后面有机会再深入说明。

>**文献检索的整合**：项目文献检索的深度整合，在新增搜索资源模块的前提下新增了事件监听模块，用来控制和编辑器内容的交互。